---
title: "EJ_Data_Exploration"
author: "Mario"
date: "7/2/2019"
output: html_document
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}

#library load
#install.packages("tidyverse")
#install.packages("sf")
#install.packages("leaflet")
#install.packages("tmap")
#install.packages("GISTools")

#install.packages("spdplyr")


library(tidyverse)
library(sf)
library(leaflet)
library(tmap)
library(raster)
library(maptools)
library(rgdal)
#library(spdplyr)


```


```{r}

#read in CES June 2018 shapefile

ces_shapefile <- st_read("CalEnvironScreen/CESJune2018Update_SHP/CES3June2018Update.shp")

#read column names for shapefile
colnames(ces_shapefile)


```

###CIScore Percent

```{r}

#set tmap as interactive mode
tmap_mode("view")

#read in visual for CalEnvironScreen with polygons set the CalEnvironScreen Score (Pollution Burden * Population Characteristics) AS PERCENTILE
tm_shape(ces_shapefile) +
  tm_polygons("CIscoreP") 

```

###Poverty Percent

```{r}


tmap_mode("view")
#read in visual for CalEnvironScreen with polygons set the POVERTY level AS PERCENTILE
tm_shape(ces_shapefile) +
  tm_polygons("povP")

```


###Along Racial Lines (Percent by Census Tract)

```{r}

tmap_mode("view")

#read in visual for CalEnvironScreen with polygons set the Race_PERCENTILE by Census Tract
tm_shape(ces_shapefile) +
  tm_polygons(c("Hispanic_p", "White_pct",  "African_Am", "Native_Ame", "Asian_Amer", "Other_pct")) +
  tm_facets(sync = TRUE) +
  tmap_options(limits = c(facets.view = 6))


```




```{r}

#read in fracking data as csv data.frame
well_location_table <- read.csv("Well_Data/AllWells_table/AllWells_20190724.csv")

#convert table to spatial data
well_location_spatial <- st_as_sf(well_location_table, coords = c("Longitude", "Latitude"), crs = 4326)

#filter out only Oil and Gas Wells (OG) and ACTIVE wells
well_location_ACTIVE <- well_location_spatial %>%
  filter(WellType == "OG" & WellStatus == "Active") 

#filter out only Oil and Gas Wells (OG) and NEW wells (Recently permitted well; in the process of being drilled)
well_location_NEW <- well_location_spatial %>% 
  filter(WellType == "OG" & WellStatus == "New") 
             

```



```{r}

#display ACTIVE well location as clusters across CA
leaflet(data = well_location_ACTIVE) %>% 
  addTiles() %>% 
  addMarkers(clusterOptions = markerClusterOptions())

```


```{r}

#display NEW well location as clusters across CA
leaflet(data = well_location_NEW) %>% 
  addTiles() %>% 
  addMarkers(clusterOptions = markerClusterOptions())



```

#Merge Well Information and Census Tract by GEOID

```{r}

st_union(well_location_spatial, tract)


```



##Find number of ACTIVE or  NEW well locations 


```{r}


tract <- st_read("tl_2016_06_tract/tl_2016_06_tract.shp")
st_transform(tract, 4326)

class(tract)

active_well_by_census <- well_location_ACTIVE %>% 
  group_by()




```



##Find number of points in each polygon 

```{r}

#using st_intersection function 



ces2 <- ces[, "tract"]  

intersect <- st_intersection(ces2, well)

tract_values <- table(intersect$tract)

tract_values <- as.data.frame(tract_values)

colnames(tract_values) <- c("Tract", "Number_Well_Sites")

head(sort(tract_values$Number_Well_Sites, decreasing=TRUE), 5)

```
