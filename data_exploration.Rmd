---
title: "EJ_Data_Exploration"
author: "Mario"
date: "7/2/2019"
output: html_document
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}

#library load

library(tidyverse)
library(sf)
library(leaflet)
library(tmap)
library(raster)
library(maptools)
library(rgdal)



```


```{r}

#read in CalEnvironScreen June 2018 shapefile

ces_shapefile <- st_read("CalEnvironScreen/CESJune2018Update_SHP/CES3June2018Update.shp")

#read column names for shapefile
colnames(ces_shapefile)


```

###CIScore Percent

```{r}

#set tmap as interactive mode
tmap_mode("view")

#read in visual for CalEnvironScreen with polygons set the CalEnvironScreen Score (Pollution Burden * Population Characteristics) AS PERCENTILE
tm_shape(ces_shapefile) +
  tm_polygons("CIscoreP") 

```

###Poverty Percent

```{r}


tmap_mode("view")
#read in visual for CalEnvironScreen with polygons set the POVERTY level AS PERCENTILE
tm_shape(ces_shapefile) +
  tm_polygons("povP")

```


###Along Racial Lines (Percent by Census Tract)

```{r}

tmap_mode("view")

#read in visual for CalEnvironScreen with polygons set the Race_PERCENTILE by Census Tract
tm_shape(ces_shapefile) +
  tm_polygons(c("Hispanic_p", "White_pct",  "African_Am", "Native_Ame", "Asian_Amer", "Other_pct")) +
  tm_facets(sync = TRUE) +
  tmap_options(limits = c(facets.view = 6))


```




```{r}

#read in fracking data as csv data.frame
ASTABLE_well_location <- read.csv("Well_Data/AllWells_table/AllWells_20190724.csv")

#convert table to spatial data
ASSPATIAL_well_location <- st_as_sf(ASTABLE_well_location, coords = c("Longitude", "Latitude"), crs = 4326)

#filter out only Oil and Gas Wells (OG) and ACTIVE wells
ACTIVE_well_location <- ASSPATIAL_well_location %>%
  filter(WellType == "OG" & WellStatus == "Active") 

#filter out only Oil and Gas Wells (OG) and NEW wells (Recently permitted well; in the process of being drilled)
NEW_well_location <- ASSPATIAL_well_location %>% 
  filter(WellType == "OG" & WellStatus == "New") 
             

```



```{r}

#display ACTIVE well location as clusters across CA
leaflet(data = ACTIVE_well_location) %>% 
  addTiles() %>% 
  addMarkers(clusterOptions = markerClusterOptions())

```


```{r}

#display NEW well location as clusters across CA
leaflet(data = NEW_well_location) %>% 
  addTiles() %>% 
  addMarkers(clusterOptions = markerClusterOptions())



```


##Find number of NEW well locations 


```{r}


#using st_intersection function 
#https://gis.stackexchange.com/questions/110117/counting-number-of-points-in-polygon-using-r


ces <- st_as_sf(ces_shapefile)
new_well <- st_as_sf(NEW_well_location)

st_crs(ces) <- 4326
st_crs(new_well) <- 4326

NEW_intersect <- st_intersection(x = ces, y = new_well)

int_results <- NEW_intersect %>% 
  group_by(tract) %>% 
  count()




```
